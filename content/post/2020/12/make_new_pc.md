+++
title = "引っ越ししたのでPCを新調した話"
author = ["derui"]
date = 2020-12-12T11:06:00+09:00
lastmod = 2020-12-12T11:06:45+09:00
tags = ["雑記"]
draft = false
+++

私用でいろいろ忙しかった原因である引っ越しが終わりました。数えたら8年半くらい同じ場所に住んでました。

で、引っ越しを期に自作PCを新調したので、それについて書いてみようと思います。

<!--more-->


## なんで新調したのか？ {#なんで新調したのか}

心機一転、という話もありますが、一番は ****使っていたPCがめっちゃでかい**** ってことでした。

ちなみに前のPCで使っていたケースはこれです。

Themaltake Urban T81

<https://kakaku.com/item/K0000626152/?cid=shop%5Fyahoo%5Fdsa%5F00010032&yclid=YSS.1000163161.EAIaIQobChMI5MqMh6LH7QIVV3RgCh3HQAkMEAAYAyAAEgLUW%5FD%5FBwE>

フルタワーケースで、全高が ****61cm**** あります。このサイズの何が問題というと、実際に問題として感じていたのは以下のような点です。

-   入るPCラックがほとんどない
    -   入手できそうなもので唯一入りそうだったのが[これ](https://www.amazon.co.jp/PJC-PJC-7201-WD-%E3%80%90%E4%B8%8A%E4%B8%8B%E6%98%87%E9%99%8D-51%EF%BD%9E80cm%E3%80%91%E3%82%B5%E3%82%A4%E3%83%89%E3%83%87%E3%82%B9%E3%82%AF%E3%83%BBL%E5%AD%97%E3%83%87%E3%82%B9%E3%82%AF%E3%83%BBCPU%E3%83%AF%E3%82%B4%E3%83%B3%E3%83%BB%E3%83%91%E3%82%BD%E3%82%B3%E3%83%B3%E3%83%AF%E3%82%B4%E3%83%B3/dp/B07W7H6LZ4/ref=asc%5Fdf%5FB07W7H6LZ4/?tag=jpgo-22&linkCode=df0&hvadid=342449963937&hvpos=&hvnetw=g&hvrand=6733612781861752480&hvpone=&hvptwo=&hvqmt=&hvdev=c&hvdvcmdl=&hvlocint=&hvlocphy=1009303&hvtargid=pla-827085345755&psc=1&tag=&ref=&adgrpid=69189144376&hvpone=&hvptwo=&hvadid=342449963937&hvpos=&hvnetw=g&hvrand=6733612781861752480&hvqmt=&hvdev=c&hvdvcmdl=&hvlocint=&hvlocphy=1009303&hvtargid=pla-827085345755)です。これも割とギリギリまで伸ばさないとならなかった・・・。
-   重い
    -   スチールラックなので当然ですが、重いです。全部部品が組み込んであると、だいたい20kgくらいになるので、ダンボールに入れるのも一苦労です（でした
-   よく考えたらそこまででかくなくていい
    -   ディスクの拡張とかそんなにしないし、でかいGPUを積むわけでもないし・・・

また、途中で一回M/Bのメモリ部分が故障してM/BごとCPU/Memory/CPUクーラーを全部新調したことはありますが、都合6年ほどこのケースを使っていたというのもあり、全面新調に至りました。


## とりあえず新しいPCの構成 {#とりあえず新しいpcの構成}

構成はこんな感じです。大体アッパーミドルくらいかな・・・。

-   ケース：Fractal Design Define R6
    -   評判のいい、ミドルタワーケースです
-   CPU：Ryzen9 3900XT
-   CPUクーラー：Nocture NH-U12A
    -   かなり高価なクーラー。しかし、Ryzen9シリーズを空冷で冷やそうとすると、これくらいは欲しかったので
-   SSD
    -   システム：Crucial M.2 P5(500GB)
    -   ストレージ：Crucial MX500 1TB
    -   HDDを卒業して、full SSD構成にしました。NVMeも使ってみたかったので。
-   Memory：Corsair 16GBx2
-   電源：Corsair RM750
-   GPU：Radeon RX 5700XT
-   マザーボード：ASRock Steel Legend B550

初めて全面的にAMD構成にしてみました。Ryzenの5xxxシリーズは全滅していたので、潔く3900を使っています。

ちなみにお値段は、しめて21万程度でした。ドスパラでまとめて購入しましたが、BTOでも大体同じくらいの値段になっていたので、まぁ相場通りかな、と。


## 組んだ {#組んだ}

大体2時間くらい・・・。毎回組むたび思うのは、システムパネルのケーブルはもうちょっと楽にならんのか・・・。というところですね。

ASUSのM/Bを使ったときにあった、 ****Q-Connector**** はほんとに楽だったので、これが標準添付されてほしいです。

<https://www.pc-master.jp/jisaku/fp-connector.html>

ここで紹介されてるみたいなやつです。システムパネルはたいてい最後の方に組み込むことが多いと思うので、割と無理のある姿勢で細かい作業をしないとならないことが・・・。

とりあえずは、ちゃんと動きました。相変わらず最初の起動は緊張しますね。幸い今まで初期不良にはあたったことが無いのですが、ここで動かないときの絶望たるや凄まじいことと思います。


## OSをインストール・・・できない？ {#osをインストール-できない}

さて、このPCにインストールするのは、かれこれ10年くらい使い続けているGentoo Linuxです。ただし、今回はCPUが切り替わるということもあったので、10年ぶりにclean installすることにしました。

いつもの通り、USBにminimal imageを書き込んで起動、さてstage3を持ってくるかー、というタイミングで気づきました。

> 「ネットワーク、つながってない・・・？」

`ip addr` をやってみても、確かにloしかデバイスが存在していないです。なん・・だと・・・？と思いながら、おもむろに `lspci` を実行してNICを探してみると、こんなやつでした。

```shell
...
07:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8125 2.5GbE Controller (rev 05)
...
```

Realtekか・・・。でも今までもRealtekだったしなー、と思いながら、RTL8125というデバイスを検索してみると、なんとこいつのドライバがKernelにmergeされたのは **5.9** のタイミング、とのこと。

どうも相当に新しいNICだったようです。いろんなフォーラムで絶望している人を見かけてます。

翻ってインストールイメージで使われているKernelをバージョンを見てみると、 **5.4.xx** という絶望の表記が見えました・・・。

さて、このデバイスはRealtekからドライバが出ているのですが、この時点ではいろいろ問題があります。

-   make/gcc/linux headerがないのでビルドできない
-   仮に外部から持ってきてもstage3とかを持ってこないとbuildできない
-   しかしstage3を持ってくるためにはRTL8125のドライバが必要
-   buildするためにはstage3が必要・・・

という、堂々巡りになってしまっていました。


## どうしたの？ {#どうしたの}

最終手段として、適当なUSB NICを買ってきてなんとかしました。Gentooでは5.9のkernelとかを普通に入れられるので助かります。

あとは、handbookを参考にインストールするだけです。

-   Ryzenだったので、 <https://wiki.gentoo.org/wiki/Ryzen> これとか
-   Radeonだったので、 <https://wiki.gentoo.org/wiki/AMDGPU> これとか
    -   Radeonも、古い世代とNaviとかの新しい世代でGPUの名前が変わっていました

今回はRadeonだったのですが、Firmwareの登録をする必要があり、ここが割とハマりポイントでした。ここで間違うと、起動直後にフリーズするので、きっちり見ましょう。

自分のGPUのmodelが何か？は、lspciの結果に `Navi 10` とか書いてあるのでそれを見てもいいし、もしくはWikiに対応表が載ってるので、それを見ても良いかと思います。


## いろいろ変えたのは別の記事で {#いろいろ変えたのは別の記事で}

さて、なんとかインストールできたので、いろいろ環境を整える・・・というところです。

これについては、今回いろいろ変えたので、別の記事で書こうと思います。

今回の教訓としては、新しいNICが入る場合、動作済みのUSB NICとかをお守りに持っておくのを推奨します。特に最近はネットワークにつながっていないとOSのインストールすらできないのがほとんどなので・・・。
